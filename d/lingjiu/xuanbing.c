//ROOM xuanbing.c
inherit ROOM;
void init();
int do_climb(object me);
int do_xia(object me);
    
void create()
{
        set("short","玄冰室");
    set("long",@LONG
这是修练内功的地方。 屋子正中有一块千年玄冰(ice)，冰上冒出丝
丝寒气， 屋里因此寒气逼人，你不由得打了一个寒颤。
LONG
    );
    
        set("exits", ([
        "east" : __DIR__"changl13",
        ]));
    set("item_desc", ([
        "ice" : "这是一块采自天山之巅的千年玄冰,据说在那上面打坐事半功倍.\n你可以试着爬(climb)上去.\n",
        ]));
 setup();
}
int do_check(object me)
{
    object where=this_object();
    object *obj;
    int i;
    obj=deep_inventory(where);
    if (!sizeof(obj))   return 0;
    for (i=0;i<sizeof(obj);i++){
        if (obj[i]==me) continue;
        if (obj[i]->is_character() && !obj[i]->is_corpse() )
            return 1;
    }
    return 0;
    
}
 
int valid_leave(object me, string dir)
{
    object where;
    
    where=environment(me);
    if (dir == "east"){
        if( where->query("xuanbing"))
            return notify_fail("你还没下(xia)地呢，就想乱跑。\n");
     }
    return ::valid_leave(me, dir);
}
void init()
{
    object ob=this_player();
    if(userp(ob) && (int)do_check(ob)){
        message_vision("$N一见房间里已经有人了，只好退了出去。\n",ob);
        ob->move(__DIR__"changl13");
        return;
    }
    add_action("do_climb", "climb");
    add_action("do_quit", "quit");
    add_action("do_xia", "xia");
}
int do_quit()
{
     set("xuanbing",0);
     return 0;
}
int do_climb(object me)
{      
        me=this_player();
    if(!me->query_skill("bahuang-gong", 1)||(int)me->query_skill("bahuang-gong", 1) < 10)
       {
        write("你的八荒六合唯我独尊功修为不够，抵御不了奇寒！\n");                   
        message_vision("$N费劲地爬上了玄冰,结果给冻得惨惨的，赶紧爬了下来。\n",me);
        return 1; 
      } 
    message_vision("$N费劲地爬上了玄冰,现在打坐可以练功了。\n",me);
    set("xuanbing",1);
    return 1;   
}
int do_xia(object me)
{
    object where;
    me=this_player();
    where=environment(me);  
    if (!where->query("xuanbing"))
     return notify_fail("你又没爬上玄冰，下到哪去呀？。\n");
    set("xuanbing",0);
    message_vision("$N练完功，精神焕发地跳下地来。\n",me);
    return 1;
}
