#include <ansi.h>

mapping *quest = ({
  ({
  (["name":                "江湖宵小",
    "where" :              "/quest/guanfu/npc/xiaoxiao",]), 
   (["name":                "山贼", 
    "where" :              "/quest/guanfu/npc/shanzei",]),
    }), 
    ({
     (["name":                "山贼", 
    "where" :              "/quest/guanfu/npc/shanzei",]),
     (["name":                "盖一鸣",
     "where" :              "/quest/guanfu/npc/gaiyiming",]),
     (["name":                "常长风",
     "where" :              "/quest/guanfu/npc/chang",]),
      (["name":                "花剑影",
     "where" :                "/quest/guanfu/npc/hua",]),
      (["name":                "黄须道人",
     "where" :                "/quest/guanfu/npc/huangxu",]),
     (["name":                "恶僧",
     "where" :                "/quest/guanfu/npc/eseng",]),
      (["name":                "曹化淳",
     "where" :                "/quest/guanfu/npc/cao",]),
      (["name":                "朱安国",
     "where" :                "/quest/guanfu/npc/zhu",]),
      }), 
      ({
         (["name":                "江洋大盗 王三",
     "where" :                "/quest/guanfu/npc/dadao",]),
       (["name":                "草寇",
     "where" :                "/quest/guanfu/npc/caokou",]),
      (["name":                "恶霸",
     "where" :                "/quest/guanfu/npc/eba",]),
      (["name":                "宋扬",
     "where" :                 "/quest/guanfu/npc/songyang",]),
      (["name":               "全二风",
     "where" :                 "/quest/guanfu/npc/quan",]),
      (["name":               "孟正鹏",
     "where" :                 "/quest/guanfu/npc/meng",]),
      (["name":               "鲜于通",
     "where" :                 "/quest/guanfu/npc/xian",]),
      (["name":               "麦鲸",
     "where" :                 "/quest/guanfu/npc/maijing",]),
      (["name":               "过三拳",
     "where" :                 "/quest/guanfu/npc/guo",]),
       }), 
      ({
      (["name":               "赵一伤",
     "where" :                 "/quest/guanfu/npc/zhaoyishang",]),   
      (["name":               "钱二败",
     "where" :                 "/quest/guanfu/npc/qian",]),    
      (["name":               "孙三毁",
     "where" :                 "/quest/guanfu/npc/sun",]),  
      (["name":               "李四摧",
     "where" :                 "/quest/guanfu/npc/li",]), 
      (["name":               "周五输",
     "where" :                 "/quest/guanfu/npc/zhou",]), 
      (["name":               "吴六破",
     "where" :                 "/quest/guanfu/npc/wu",]), 
      (["name":               "郑七灭",
     "where" :                 "/quest/guanfu/npc/zheng",]), 
      (["name":               "元广波",
     "where" :                 "/quest/guanfu/npc/yuan",]), 
      (["name":               "徐长老",
     "where" :                 "/quest/guanfu/npc/xu",]), 
      (["name":               "单狰",
     "where" :                 "/quest/guanfu/npc/shan",]), 
      (["name":               "霍元风",
     "where" :                 "/quest/guanfu/npc/huo",]),
      }), 
      ({
      (["name":               "阿大",
     "where" :                 "/quest/guanfu/npc/ada",]),  
      (["name":               "阿二",
     "where" :                 "/quest/guanfu/npc/aer",]), 
      (["name":               "阿三",
     "where" :                 "/quest/guanfu/npc/asan",]), 
      (["name":               "玉真子",
     "where" :                 "/quest/guanfu/npc/yu",]),    
     }),
     });
mapping *wheres=({
          
      (["chinese":                "大理北门",
       "weizhi" :              "/d/dali/beidajie3",]),  
      (["chinese":                "扬州林间小道",
       "weizhi" :              "/d/heimuya/linjxd5",]),  
     (["chinese":                "峨嵋华藏庵",
       "weizhi" :              "/d/emei/huazangan",]),
     (["chinese":                "襄阳玄武内门",
       "weizhi" :              "/d/xiangyang/northgate1",]),
     (["chinese":                "襄阳青龙内门",
       "weizhi" :              "/d/xiangyang/eastgate1",]),
     (["chinese":                "扬州西门",
       "weizhi" :              "/d/city/ximen",]),
     (["chinese":                "雪山土路",
       "weizhi" :              "/d/xueshan/tulu2",]),
     (["chinese":                "长安碑林",
       "weizhi" :              "/d/changan/ca16",]),
     (["chinese":                "成都凉亭",
       "weizhi" :              "/d/city3/liangting",]),
     (["chinese":                "北京朝阳路",
       "weizhi" :              "/d/city2/chaoyan2",]),
     (["chinese":                "泉州烟雨楼",
       "weizhi" :              "/d/quanzhou/yanyu",]),
     (["chinese":                "南阳悦来客栈",
       "weizhi" :              "/d/nanyang/kedian1",]),
     (["chinese":                "青城三岛石",
       "weizhi" :              "/d/qingcheng/sandaoshi",]),
     (["chinese":                "苗疆苗人部落",
       "weizhi" :              "/d/heimuya/zhaoze/room14",]),  
      (["chinese":                "扬州中央广场",
       "weizhi" :              "/d/city/guangchang",]),  
      (["chinese":                "侠客岛南海渔村",
       "weizhi" :              "/d/xiakedao/xkroad4",]), 
      (["chinese":                "雪山山脚",
       "weizhi" :              "/d/xueshan/shanjiao",]), 
      (["chinese":                "杀手楼校场",
       "weizhi" :              "/d/shashou/jiaochang",]), 
      (["chinese":                "星宿海北疆小镇",
       "weizhi" :              "/d/xingxiu/beijiang",]), 
      (["chinese":                "武当紫霄宫",
       "weizhi" :              "/d/wudang/zixiaogong",]), 
      (["chinese":                "峨嵋十二盘",
       "weizhi" :              "/d/emei/shierpan3",]), 
      (["chinese":                "峨嵋千佛庵",
       "weizhi" :              "/d/emei/qianfoan",]), 
      (["chinese":                "峨嵋九十九道拐",
       "weizhi" :              "/d/emei/jiudaoguai1",]), 
      (["chinese":                "明教厚土旗门",
       "weizhi" :              "/d/mingjiao/htqmen",]), 
      (["chinese":                "明教烈火旗后门",
       "weizhi" :              "/d/mingjiao/lhqhoumen",]), 
      (["chinese":                "昆仑石阶",
       "weizhi" :              "/d/kunlun/klsj2",]), 
      (["chinese":                "高昌峭壁",
       "weizhi" :              "/d/gaochang/room50",]), 
      (["chinese":                "星宿海沙漠",
       "weizhi" :              "/d/xingxiu/shamo2",]),
      (["chinese":                "少林寺石阶",
       "weizhi" :              "/d/shaolin/shijie8",]),
      (["chinese":                "襄阳石阶",
       "weizhi" :              "/d/xiangyang/walle1",]),
      (["chinese":                "华山猢狲愁",
       "weizhi" :              "/d/huashan/husun",]),
      (["chinese":                "华山玉女峰",
       "weizhi" :              "/d/huashan/yunu",]),
      (["chinese":                "慕容小径",
       "weizhi" :              "/d/mr/xiaojing1-2",]),
      (["chinese":                "慕容柳树林",
       "weizhi" :              "/d/mr/liulin",]),
      (["chinese":                "大理夕照路",
       "weizhi" :              "/d/dali/xbdajie3",]),
      (["chinese":                "扬州城北门",
       "weizhi" :              "/d/city/beimen",]),
      (["chinese":                "北京城小桥",
       "weizhi" :              "/d/city2/bridge",]),
      (["chinese":                "北京城永定门",
       "weizhi" :              "/d/city2/yongding",]),
      (["chinese":                "少林寺山门殿",
       "weizhi" :              "/d/shaolin/smdian",]),
      (["chinese":                "少林寺走廊",
       "weizhi" :              "/d/shaolin/zoulang7",]),
      (["chinese":                "武当磨针井",
       "weizhi" :              "/d/wudang/shuijing",]),
      (["chinese":                "少林寺般若堂九部",
       "weizhi" :              "/d/shaolin/banruo9",]),
      (["chinese":                "雪山圣湖",
       "weizhi" :              "/d/xueshan/shenghu",]),
      (["chinese":                "峨嵋九老洞",
       "weizhi" :              "/d/emei/jiulaodong",]),
       (["chinese":                "峨嵋古德林",
       "weizhi" :              "/d/emei/gudelin",]),
        
           });
void init()
{
        add_action("do_jie", ({"xian","jie"}));
     
}

int do_jie(string arg)
{
	object me, ob;
        mapping weizhis, target;
//	string  weishis;
	int exp, position;

	if(!arg) return 0;
	me = this_player();
        ob = this_player(); 
	exp=(int)me->query("combat_exp"); 
        weizhis = wheres[random(sizeof(wheres))];
//        weishis = quest[random(sizeof(wheres))];

	if(arg != "wenshu" && arg != "wen") return 0;

	if(me->query_condition("gb_mission") || me->query_condition("gb_busy") || me->query_condition("xx_task")
        || me->query_condition("dali_songxin"))
		return notify_fail("你现在正忙着做其他任务呢！\n");
	if(me->query_condition("guanfu_task"))
		return notify_fail("你已经揭过榜了，难道不想做了？！\n");
	if(me->query_temp("guanfu_task") || present("wenshu", me))
        return notify_fail("你身上还有文书，可以通过(kan wenshu)来查询。\n");
        
        if(me->query_condition("gf_busy"))
        return notify_fail("你发现文书已经被人揭光了，看样子要等一会了！\n");
	if(exp>150000000)
		return notify_fail("你在江湖上已是大名鼎鼎，这种小事怎敢劳您大驾？\n");

    if(exp<210000)
		return notify_fail("你刚想伸手，忽然看到上面凶神恶煞的画像，想了想觉得自己的这点功夫，还是算了吧。\n"); 
	if(exp>=500000000) position=5;
	else if(exp>=150000000) position=4;
	else if(exp>=15000000) position=3;
	else if(exp>=210000) position=2;
	else position=1;
//        target = quest[random(sizeof(quest))];
	target = quest[position-1][random(sizeof(quest[position-1]))]; 
//      while (sizeof(filter_array(children(target["where"]), (: clonep :))) > 0)
        target = quest[position-1][random(sizeof(quest[position-1]))];
        
        if(exp>=500000000){
	tell_room(this_object(),
		HIY + me->name()
		+ "推开围观的行人，走到近前,微微睁开眼睛，冷冷瞥了一眼告示，随手揭了下来揣进了怀中。\n"NOR, ({ me }));
	write(HIY"你推开围观的行人，走到近前,微微睁开眼睛，冷冷瞥了一眼告示，随手揭了下来揣进了怀中。\n"NOR);
	 }
        if(exp<=15000000){
        tell_room(this_object(),
                 HIY + me->name()
                 + "壮了壮胆，费力拔开行人，来到近前深深吸了口气，竭力镇定一下紧张的心情，四下看了看，悄悄把文书揭了下来。\n"NOR, ({ me }));
        write(HIY"你壮了壮胆，费力拔开行人，来到近前深深吸了口气，竭力镇定一下紧张的心情，四下看了看，悄悄把文书揭了下来。\n"NOR);
         }
        if(exp>15000000 && exp<500000000){
        tell_room(this_object(),
                 HIY + me->name()
                 + "分开行人来到近前，目光淡淡的扫视了几眼告示，嘴角微微一翘，神态自如的把文书揭了下来。\n"NOR, ({ me }));
        write(HIY"你分开行人来到近前，目光淡淡的扫视了几眼告示，嘴角微微一翘，神态自如的把文书揭了下来。\n"NOR);
        }
        me->set_temp("mark/gkill1",1);
	me->set_temp("guanfu_target", target["name"]);
        me->set_temp("path_rooms", target["where"]);
        me->set_temp("gstart_rooms", weizhis["weizhi"]);
        me->set_temp("ch_weizhi", weizhis["chinese"]);
        new(__DIR__"wenshu1")->move(me);
//       me->move(me->query_temp("start_rooms"));
        ob = new(me->query_temp("path_rooms"));
//      ob->move("/d/city/kongchang");
        ob->move(me->query_temp("gstart_rooms"));
        me->apply_condition("guanfu_task", me->set_temp("guanfu_time", random(70)+20));
        me->apply_condition("gf_busy", random(20)+20);
        
	return 1;
}
